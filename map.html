<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tree Map</title>
  <style>
    #map {width:100%; height:100vh;}
  </style>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4010951d8779c420a474f095fd26c0a6"></script>
</head>
<body>
<div id="map"></div>
<script>
// ✅ Master DB에 기록된 Google Drive 공유 CSV 링크
const driveCsvUrl = "https://drive.google.com/uc?export=download&id=YOUR_FILE_ID";

// CSV 파싱 함수
async function fetchCsv(url) {
  const res = await fetch(url);
  const text = await res.text();
  return text.split("\n").slice(1).map(row => {
    const [id, name, species, lat, lng, date] = row.split(",");
    return { id, name, species, lat: parseFloat(lat), lng: parseFloat(lng), date };
  });
}

async function initMap() {
  const trees = await fetchCsv(driveCsvUrl);

  // 지도 초기화 (첫 번째 좌표 중심)
  const mapContainer = document.getElementById("map");
  const mapOption = { center: new kakao.maps.LatLng(trees[0].lat, trees[0].lng), level: 4 };
  const map = new kakao.maps.Map(mapContainer, mapOption);

  // 마커 표시
  trees.forEach(tree => {
    if (!tree.lat || !tree.lng) return;
    const marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(tree.lat, tree.lng),
      map: map
    });

    const infowindow = new kakao.maps.InfoWindow({
      content: `<div style="padding:5px;">${tree.name} (${tree.species})<br>${tree.date}</div>`
    });

    kakao.maps.event.addListener(marker, "click", () => {
      infowindow.open(map, marker);
    });
  });
}

initMap();
</script>
</body>
</html>
