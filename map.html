<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>수목 위치도</title>
  <style>
    #map {width:100%; height:100vh;}
  </style>
  <!-- 카카오맵 JS SDK -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4010951d8779c420a474f095fd26c0a6"></script>
</head>
<body>
<div id="map"></div>
<script>
// 🔹 URL 파라미터에서 fileId 추출
const urlParams = new URLSearchParams(window.location.search);
const fileId = urlParams.get("fileId");

// 🔹 Google Drive CSV 파일 다운로드 URL
const driveCsvUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;

// 🔹 CSV 파싱 함수
async function fetchCsv(url) {
  const res = await fetch(url);
  const text = await res.text();
  return text.split("\n").slice(1).map(row => {
    const [id, lat, lng] = row.split(",");
    return { id, lat: parseFloat(lat), lng: parseFloat(lng) };
  });
}

// 🔹 지도 초기화 및 마커 표시
async function initMap() {
  const trees = await fetchCsv(driveCsvUrl);
  alet(trees);
  if (!trees.length) {
    alert("CSV 데이터가 없습니다.");
    return;
  }

  const mapContainer = document.getElementById("map");
  const mapOption = {
    center: new kakao.maps.LatLng(trees[0].lat, trees[0].lng),
    level: 4
  };
  const map = new kakao.maps.Map(mapContainer, mapOption);

  trees.forEach(tree => {
    if (!tree.lat || !tree.lng) return;

    const marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(tree.lat, tree.lng),
      map: map
    });

    // const infowindow = new kakao.maps.InfoWindow({
    //   content: `<div style="padding:5px;">${tree.name} (${tree.species})<br>${tree.date}</div>`
    // });

    // kakao.maps.event.addListener(marker, "click", () => {
    //   infowindow.open(map, marker);
    // });
  });
}

initMap();
</script>
</body>
</html>
