<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ìˆ˜ëª© ìœ„ì¹˜ë„</title>
  <style>
    #map {width:100%; height:100vh;}
  </style>
  <!-- ì¹´ì¹´ì˜¤ë§µ JS SDK -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4010951d8779c420a474f095fd26c0a6"></script>
</head>
<body>
<div id="map"></div>
<script>
// ğŸ”¹ URL íŒŒë¼ë¯¸í„°ì—ì„œ fileId ì¶”ì¶œ
const urlParams = new URLSearchParams(window.location.search);
const fileId = urlParams.get("fileId");

// ğŸ”¹ Google Drive CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ URL
const driveCsvUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;

// ğŸ”¹ CSV íŒŒì‹± í•¨ìˆ˜
async function fetchCsv(url) {
  const res = await fetch(url);
  const text = await res.text();
  return text.split("\n").slice(1).map(row => {
    const [id, lat, lng] = row.split(",");
    return { id, lat: parseFloat(lat), lng: parseFloat(lng) };
  });
}

// ğŸ”¹ ì§€ë„ ì´ˆê¸°í™” ë° ë§ˆì»¤ í‘œì‹œ
async function initMap() {
  const trees = await fetchCsv(driveCsvUrl);
  alet(trees);
  if (!trees.length) {
    alert("CSV ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const mapContainer = document.getElementById("map");
  const mapOption = {
    center: new kakao.maps.LatLng(trees[0].lat, trees[0].lng),
    level: 4
  };
  const map = new kakao.maps.Map(mapContainer, mapOption);

  trees.forEach(tree => {
    if (!tree.lat || !tree.lng) return;

    const marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(tree.lat, tree.lng),
      map: map
    });

    // const infowindow = new kakao.maps.InfoWindow({
    //   content: `<div style="padding:5px;">${tree.name} (${tree.species})<br>${tree.date}</div>`
    // });

    // kakao.maps.event.addListener(marker, "click", () => {
    //   infowindow.open(map, marker);
    // });
  });
}

initMap();
</script>
</body>
</html>
