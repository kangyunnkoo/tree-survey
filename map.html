<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>수목 위치도</title>
  <style>
    #map {width:100%; height:100vh;}
  </style>
  <script type="text/javascript" 
          src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4010951d8779c420a474f095fd26c0a6"></script>
</head>
<body>
<div id="map"></div>

<script>
  // 1) URL에서 JSON 파일 경로 가져오기
  const urlParams = new URLSearchParams(window.location.search);
  const src = urlParams.get('src');

  fetch(src)
    .then(res => res.json())
    .then(data => {
      if (!data || data.length === 0) {
        alert('표시할 데이터가 없습니다.');
        return;
      }

      // 지도 초기화 (첫 번째 좌표 기준)
      const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(data[0].lat, data[0].lng),
        level: 4
      });

      const bounds = new kakao.maps.LatLngBounds();

      // 2) 모든 좌표에 마커 + 라벨 표시
      data.forEach(item => {
        const pos = new kakao.maps.LatLng(item.lat, item.lng);

        // 마커
        const marker = new kakao.maps.Marker({ position: pos });
        marker.setMap(map);

        // 라벨(커스텀 오버레이)
        const overlay = new kakao.maps.CustomOverlay({
          position: pos,
          content: `<div style="background:white;border:1px solid #333;padding:2px 4px;font-size:12px;">${item.label}</div>`,
          yAnchor: 1.5
        });
        overlay.setMap(map);

        bounds.extend(pos);
      });

      map.setBounds(bounds); // 모든 마커가 보이도록 지도 범위 조정
    })
    .catch(err => console.error('JSON fetch error:', err));
</script>
</body>
</html>
